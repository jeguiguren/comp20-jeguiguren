<!DOCTYPE html>

<html>

	<head>
		<title>Your Location</title>
		<link href="style.css" rel="stylesheet" />
		<meta charset="utf-8" />
		<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
		
		<script>
			var myLat = 0;
			var myLng = 0;
			const username = "1Mjovzzth6";
			function initUber() {
				navigator.geolocation.getCurrentPosition(getLocation);	
			}

			function getLocation(position) {
				outputDiv = document.getElementById("myinfo");	
				myLat = position.coords.latitude;
				myLng = position.coords.longitude;
				outputElem = document.getElementById("info");
				locString = "<h3>Location: " + myLat + ", " + myLng + "</h3>";
				outputDiv.innerHTML = locString;
				sendLocation();
			}
			
			function sendLocation() {
				var xhr = new XMLHttpRequest();
				var params = "username=" + username + "&lat=" + myLat + "&lng=" + myLng;
				var url = "https://jordan-marsh.herokuapp.com/rides";
				xhr.open("POST", url, true);

				//Send the proper header information along with the request
				xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

				xhr.onreadystatechange = function() {//Call a function when the state changes.
    				if(xhr.readyState == 4 && xhr.status == 200) {

    					outputDiv = document.getElementById("info");

						info = xhr.responseText;				
						obj = JSON.parse(info);
						targets = obj.vehicles;
						if (targets == null) {
							targets = obj.passengers;
						}

						outputString = "";
						for (count in targets) {
							outputString += "<p>username: " + targets[count].username + ", location:  " + targets[count].lat + " " + targets[count].lng + "</p>"
						}
						outputDiv.innerHTML = outputString;
    				}
    			}
			
			xhr.send(params);
			}
		
		</script>

	</head>
	
	<body onload="initUber()">
		<h1>NOT YOUR UBER</h1>
		<div id="myinfo"></div>
		<div id="info"></div>
		<div id="map_canvas"></div>
	</body>

</html>


